---
title: "Keys and Strings"
author: "Matthew Davis"
date: "December 19, 2017"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, comment = '')
library(keysandstrings)
```

##### String Chunking
 
basic string processing functions
 
```{r string functions}
chunk_string('aaabbbcccddd',  chunk_len=3)
split_key(c('aaabbb', 'aaaccc','bbbaaa'),  chunk_len = 3)
```

#####  level coder

replaces a factor levels in a data frame with a code that with a consistant number of characters.  
This feature helps for grouped time series in the hts package that requires keys with consistant length

```{r level coder}
data = data.frame(x = rep(c('xkey1', 'xkey2'),2), y = rep(c('ykey1', 'ykey2', 'ykey3', NA)))
data
lc = level_coder(data)
x = predict(lc, data)
print(x)
predict(lc, x, rev = TRUE)
key = predict(lc,data,return_primkey =  TRUE)
print(key)
predict(lc, key)
```

##### TS Features

get lagged features from time series data. Works on a data frame or a time seires object. Uses keys and a data col.
Handles missing values by carrying the next forward.  This might be problematic for seasonal times series, so it's better to deal with NAs before running this. 


```{r tsfeatures }
head(ts_features(AirPassengers),2)

tail(ts_features(AirPassengers),2)




params =  list(time_col = 'date', 
                    key_col = 'key', 
                    val_col = 'val', 
                    n_future = 2, 
                    n_past = 2,
                    na_fill = NA)
data = data.frame(date = rep(1:10,2), key = c(rep('a',10), rep('b',10) ), val =c(1:10, 2:11))
ts_features(data, params)

# this demonstrates the back fill capability for missing 
data = data.frame(date = c(2:10, 1:10), key = c(rep('a',9), rep('b',10) ), val =c(2:10, 1:10))
new_data = ts_features(data, params)
new_data[ order(new_data$key, new_data$date),]
```



```{r keyscaler}
data = data.frame(key = c(rep('a',40), rep(' b',40)), val1 =  c(1:80), val2 = c(2:81)) 
params = list(key_col = 'key', trans_cols = c('val1', 'val2'), scale = TRUE, center = TRUE)
ks = keyscale(data, params)
x = predict(ks, data)
head(data)
head(x)
head(predict(ks, x, rev = TRUE))
```

##### Black list

```{r black_list}

data = data.frame(a = c(rep('aa', 9), 'b'), b = c(rep('aa', 10)))
bl = black_list(data, cols = c('a', 'b'), freq = 9 )
predict(bl, data)


```

